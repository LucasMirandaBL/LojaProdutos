<div class="container mt-4">
  <h2>{{ editando ? 'Editar Produto' : 'Novo Produto' }}</h2>

  <div *ngIf="carregando" class="text-center my-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p>Carregando dados do produto...</p>
  </div>

  <div *ngIf="erro" class="alert alert-danger" role="alert">
    {{ erro }}
  </div>

  <form [formGroup]="produtoFormulario" (ngSubmit)="salvarProduto()" *ngIf="!carregando">
    <div class="mb-3">
      <label for="nome" class="form-label">Nome</label>
      <input type="text" class="form-control" id="nome" formControlName="nome"
             [class.is-invalid]="produtoFormulario.get('nome')?.invalid && produtoFormulario.get('nome')?.touched">
      <div *ngIf="produtoFormulario.get('nome')?.invalid && produtoFormulario.get('nome')?.touched" class="invalid-feedback">
        Nome é obrigatório.
      </div>
    </div>

    <div class="mb-3">
      <label for="preco" class="form-label">Preço</label>
      <input type="number" class="form-control" id="preco" formControlName="preco"
             [class.is-invalid]="produtoFormulario.get('preco')?.invalid && produtoFormulario.get('preco')?.touched">
      <div *ngIf="produtoFormulario.get('preco')?.invalid && produtoFormulario.get('preco')?.touched" class="invalid-feedback">
        Preço é obrigatório e deve ser um número válido.
      </div>
    </div>

    <div class="mb-3">
      <label for="descricao" class="form-label">Descrição</label>
      <textarea class="form-control" id="descricao" formControlName="descricao" rows="3"
                [class.is-invalid]="produtoFormulario.get('descricao')?.invalid && produtoFormulario.get('descricao')?.touched"></textarea>
      <div *ngIf="produtoFormulario.get('descricao')?.invalid && produtoFormulario.get('descricao')?.touched" class="invalid-feedback">
        Descrição é obrigatória.
      </div>
    </div>

    <div class="mb-3">
      <label for="categoria" class="form-label">Categoria</label>
      <select class="form-select" id="categoria" formControlName="categoria"
              [class.is-invalid]="produtoFormulario.get('categoria')?.invalid && produtoFormulario.get('categoria')?.touched">
        <option value="" disabled>Selecione uma categoria</option>
        <option *ngFor="let cat of categorias" [value]="cat">{{ cat | titlecase }}</option>
      </select>
      <div *ngIf="produtoFormulario.get('categoria')?.invalid && produtoFormulario.get('categoria')?.touched" class="invalid-feedback">
        Categoria é obrigatória.
      </div>
    </div>

    <div class="mb-3">
      <label for="imagem" class="form-label">URL da Imagem</label>
      <input type="url" class="form-control" id="imagem" formControlName="imagem"
             [class.is-invalid]="produtoFormulario.get('imagem')?.invalid && produtoFormulario.get('imagem')?.touched">
      <div *ngIf="produtoFormulario.get('imagem')?.invalid && produtoFormulario.get('imagem')?.touched" class="invalid-feedback">
        URL da Imagem é obrigatória e deve ser um formato válido.
      </div>
      <div *ngIf="produtoFormulario.get('imagem')?.value" class="mt-2">
        <img [src]="produtoFormulario.get('imagem')?.value" alt="Preview da Imagem" class="img-thumbnail" style="max-width: 150px;">
      </div>
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="produtoFormulario.invalid">Salvar</button>
    <button type="button" class="btn btn-secondary ms-2" (click)="voltarParaLista()">Cancelar</button>
  </form>
</div>